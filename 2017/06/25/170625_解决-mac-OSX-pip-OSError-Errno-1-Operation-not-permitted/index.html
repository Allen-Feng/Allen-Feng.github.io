
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>解决 mac OSX pip OSError: [Errno 1] Operation not permitted | aFeng`s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Allen Feng">
    

    
    <meta name="description" content="这段时间在弄机器学习的事情，然后看Macbook里面的Python库有点旧，就用pip更新一下。结果抛出个异常。">
<meta property="og:type" content="article">
<meta property="og:title" content="解决 mac OSX pip OSError: [Errno 1] Operation not permitted">
<meta property="og:url" content="http://yoursite.com/2017/06/25/170625_解决-mac-OSX-pip-OSError-Errno-1-Operation-not-permitted/index.html">
<meta property="og:site_name" content="aFeng`s Blog">
<meta property="og:description" content="这段时间在弄机器学习的事情，然后看Macbook里面的Python库有点旧，就用pip更新一下。结果抛出个异常。">
<meta property="og:updated_time" content="2017-08-29T03:13:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="解决 mac OSX pip OSError: [Errno 1] Operation not permitted">
<meta name="twitter:description" content="这段时间在弄机器学习的事情，然后看Macbook里面的Python库有点旧，就用pip更新一下。结果抛出个异常。">
<meta name="twitter:creator" content="@allenfeng945">

    
    <link rel="alternative" href="/atom.xml" title="aFeng`s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="aFeng`s Blog" title="aFeng`s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="aFeng`s Blog">aFeng`s Blog</a></h1>
				<h2 class="blog-motto">记录学习的点点滴滴</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/06/25/170625_解决-mac-OSX-pip-OSError-Errno-1-Operation-not-permitted/" title="解决 mac OSX pip OSError: [Errno 1] Operation not permitted" itemprop="url">解决 mac OSX pip OSError: [Errno 1] Operation not permitted</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Allen Feng" target="_blank" itemprop="author">Allen Feng</a>
		
  <p class="article-time">
    <time datetime="2017-06-25T13:14:16.000Z" itemprop="datePublished"> 发表于 2017-06-25</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-number">1.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1"><span class="toc-number">2.</span> <span class="toc-text">Step 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2"><span class="toc-number">3.</span> <span class="toc-text">Step 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3"><span class="toc-number">4.</span> <span class="toc-text">Step 3</span></a></li></ol>
		
		</div>
		
		<blockquote>
<p>这段时间在弄机器学习的事情，然后看Macbook里面的Python库有点旧，就用pip更新一下。结果抛出个异常。</p>
</blockquote>
<a id="more"></a>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>正常的包更新使用如下命令即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install scipy --upgrade</div></pre></td></tr></table></figure></p>
<p>结果抛出下面这个异常报告</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Exception:</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/basecommand.py&quot;, line 215, in main</div><div class="line">    status = self.run(options, args)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/commands/install.py&quot;, line 342, in run</div><div class="line">    prefix=options.prefix_path,</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/req/req_set.py&quot;, line 778, in install</div><div class="line">    requirement.uninstall(auto_confirm=True)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/req/req_install.py&quot;, line 754, in uninstall</div><div class="line">    paths_to_remove.remove(auto_confirm)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/req/req_uninstall.py&quot;, line 115, in remove</div><div class="line">    renames(path, new_path)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip/utils/__init__.py&quot;, line 267, in renames</div><div class="line">    shutil.move(old, new)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 302, in move</div><div class="line">    copy2(src, real_dst)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 131, in copy2</div><div class="line">    copystat(src, dst)</div><div class="line">  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 103, in copystat</div><div class="line">    os.chflags(dst, st.st_flags)</div><div class="line">OSError: [Errno 1] Operation not permitted: &apos;/var/folders/zc/hgpffx914m9fn07sw5tmn23w0000gn/T/pip-bWVMmR-uninstall/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/numpy-1.8.0rc1-py2.7.egg-info&apos;</div></pre></td></tr></table></figure>
<h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h2><p>Google后找到这个解决方案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo pip install numpy --upgrade --ignore-installed</div><div class="line">$ sudo pip install scipy --upgrade --ignore-installed</div><div class="line">$ sudo pip install scikit-learn --upgrade --ignore-installed</div></pre></td></tr></table></figure>
<blockquote>
<p>首先说明一下我的电脑环境，<code>python2.0</code>是系统自带的，后续手动装了<code>pyhton3.0</code>，相关<code>pip</code>操作分别使用<code>pip **</code>和<code>pip3 **</code>区分。现打算把<code>python2.0</code>下的scipy模块升级到最新版。上述方法执结果显示是成功了，但查看scipy模块版本时发现<code>python2.0</code>下仍旧是旧版本，<code>pyhton3.0</code>下却升级到最新版了。推测可能是因系统自带的<code>Python2.0</code>受到SIP管理，上述方法执行时识别到此信息后就去更新<code>python3.0</code>下的模块。因没有对不同环境做交叉验证，以上推理或许有误，但目前能解释我遇到的情况，权且如此。</p>
</blockquote>
<h2 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h2><p><code>SIP</code>: 系统完整性保护System Integrity Protection。简单来讲就是更加强制性的保护系统相关的文件夹。开发者不能直接操作相关的文件内容。<a href="https://support.apple.com/en-us/HT204899" target="_blank" rel="external">苹果官方的解释:</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">System Integrity Protection is a security technology in OS X El Capitan that’s designed to help prevent potentially malicious software from modifying protected files and folders on your Mac. </div><div class="line">In OS X, the “root” user account previously had no permission restrictions and could access any system folder or application on your Mac. Software gained root-level access when you entered your administrator name and password to install it and could then modify or overwrite any system file or application. </div><div class="line">System Integrity Protection restricts the root account and limits the actions that the root user can perform on protected parts of OS X. </div><div class="line">Paths and applications protected by System Integrity Protection include: </div><div class="line">/System </div><div class="line">/usr </div><div class="line">/bin </div><div class="line">/sbin </div><div class="line">Apps that are pre-installed with OS X </div><div class="line">Paths and applications that third-party apps and installers can write to include: </div><div class="line">/Applications </div><div class="line">/Library </div><div class="line">/usr/local </div><div class="line">System Integrity Protection is designed to allow modifications of these protected parts only by processes that are signed by Apple and have special entitlements to write to system files, like Apple software updates and Apple installers. </div><div class="line">Apps that you download from the Mac App Store already work with System Integrity Protection. Other third-party software that conflicts with System Integrity Protection might be set aside when you upgrade to OS X El Capitan. </div><div class="line">System Integrity Protection also helps prevent software from changing your startup volume. To boot your Mac from a different volume, you can use the Startup Disk pane in System Preferences or you can hold down the Option key while you reboot, and select a volume from the list. </div><div class="line">Information about products not manufactured by Apple, or independent websites not controlled or tested by Apple, is provided without recommendation or endorsement. Apple assumes no responsibility with regard to the selection, performance, or use of third-party websites or products. Apple makes no representations regarding third-party website accuracy or reliability. Risks are inherent in the use of the Internet. Contact the vendor for additional information. Other company and product names may be trademarks of their respective owners. </div><div class="line">Last Modified: Oct 2, 2015</div></pre></td></tr></table></figure>
<p>找到问题的原因就可以解决相关的问题了，解决问题的方法就是关闭Mac系统的“SIP“。</p>
<p>具体的操作步骤，引用国外的一个牛人给出的<a href="http://www.imore.com/el-capitan-system-integrity-protection-helps-keep-malware-away?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">方法</a> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">How to turn off System Integrity Protection in El Capitan</div><div class="line"></div><div class="line">Click the  menu.</div><div class="line">Select Restart…</div><div class="line">Hold down command-R to boot into the Recovery System.</div><div class="line">Click the Utilities menu and select Terminal.</div><div class="line">Type csrutil disable and press return .</div><div class="line">Close the Terminal app.</div><div class="line">Click the  menu and select Restart… .</div></pre></td></tr></table></figure>
<p>翻译过来就是：</p>
<ol>
<li>点击Mac电脑的苹果图标</li>
<li>选择 重新启动</li>
<li>按住 command＋R，直到进入还原模式</li>
<li>选择实用工具，然后点击 终端</li>
<li>输入 <code>csrutil disable</code> 按下回车</li>
<li>重启电脑</li>
</ol>
<p>这样就将“SIP“关闭了。</p>
<p>然后我们使用 pip 安装升级numpy、scipy等相关的包。</p>
<p>问题是解决了，但是如果到这里就认为已经万事大吉了，其实是大错特错了。苹果官方之所以设置“SIP“主要是考虑到系统的安全性问题。所以，我们最好还是将“SIP“打开。打开的方式如下： </p>
<ol>
<li>点击Mac电脑的苹果图标 </li>
<li>选择 重新启动 </li>
<li>按住 command＋R，直到进入还原模式</li>
<li>选择实用工具，然后点击 终端 </li>
<li>输入 <code>csrutil enable</code> 按下回车 </li>
<li>重启电脑</li>
</ol>
<h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h2><p>再次执行第一步的升级命令，仍旧和之前一样的结果。SIP都关了，那就大胆的去做吧，找到scipy模块的path，手动删掉，再次执行命令，结果就OK了。<br>因多看了一眼刚打开的Finder界面，惊奇地发现没有scipy这个模块，再次把path显示出来发现和之前的路径已经不一样了。原来系统自带的模块和手动安装的模块不在一个路径下，至于为什么这样，留待以后再去想吧，毕竟目前的问题已经解决了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import scipy</div><div class="line">&gt;&gt;&gt; scipy.__version__</div><div class="line">&apos;0.13.0b1&apos;</div><div class="line">&gt;&gt;&gt; scipy.__path__</div><div class="line">[&apos;/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/scipy&apos;]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import scipy</div><div class="line">&gt;&gt;&gt; scipy.__version__</div><div class="line">&apos;0.19.1&apos;</div><div class="line">&gt;&gt;&gt; scipy.__path__</div><div class="line">[&apos;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/scipy&apos;]</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ML/">ML</a><a href="/tags/Python/">Python</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/06/25/170625_解决-mac-OSX-pip-OSError-Errno-1-Operation-not-permitted/" data-title="解决 mac OSX pip OSError: [Errno 1] Operation not permitted | aFeng`s Blog" data-tsina="5580378505" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/07/15/170715_Install-graphviz-on-MacOS/" title="Install graphviz on MacOS">
  <strong>上一篇：</strong><br/>
  <span>
  Install graphviz on MacOS</span>
</a>
</div>


<div class="next">
<a href="/2017/06/22/170622_在Mac环境安装tesseract-ocr/"  title="在Mac环境安装tesseract ocr">
 <strong>下一篇：</strong><br/> 
 <span>在Mac环境安装tesseract ocr
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/06/25/170625_解决-mac-OSX-pip-OSError-Errno-1-Operation-not-permitted/" data-title="解决 mac OSX pip OSError: [Errno 1] Operation not permitted" data-url="http://yoursite.com/2017/06/25/170625_解决-mac-OSX-pip-OSError-Errno-1-Operation-not-permitted/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-number">1.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1"><span class="toc-number">2.</span> <span class="toc-text">Step 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2"><span class="toc-number">3.</span> <span class="toc-text">Step 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3"><span class="toc-number">4.</span> <span class="toc-text">Step 3</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Allen-Feng" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/ML/" title="ML">ML<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode/" title="Xcode">Xcode<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Mac/" title="Mac">Mac<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ARC/" title="ARC">ARC<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pyhton/" title="Pyhton">Pyhton<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Crawler/" title="Crawler">Crawler<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SDK/" title="SDK">SDK<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/RSA/" title="RSA">RSA<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/vim/" title="vim">vim<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cocoachina.com" target="_blank" title="CocoaChina">CocoaChina</a>
            
          </li>
        
          <li>
            
            	<a href="https://objccn.io/" target="_blank" title="objc中国">objc中国</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.devtang.com/" target="_blank" title="唐巧大神">唐巧大神</a>
            
          </li>
        
          <li>
            
            	<a href="http://yulingtianxia.com/" target="_blank" title="玉令天下">玉令天下</a>
            
          </li>
        
          <li>
            
            	<a href="https://onevcat.com/#blog" target="_blank" title="王巍（@onevcat）">王巍（@onevcat）</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=5580378505&verifier=07a80851&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Stay hungry, stay foolish <br/>
			Talk is cheap, show me the code.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5580378505" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Allen-Feng" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6587241" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/allenfeng945" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/profile.php?id=100011457513784" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		
		<a href="mailto:allen-feng@hotmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Allen Feng">Allen Feng</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"allenfeng123"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
